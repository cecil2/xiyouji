<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¥¿æ¸¸é—¯å…³ | æ–—æˆ˜èƒœä½›ç‰ˆ</title>
    <style>
        /* =========================================
           1. è§†è§‰ç³»ç»Ÿå®šä¹‰ (Visual System)
           ========================================= */
        :root {
            --c-primary: #c0392b;       /* ä¸¹æ¼†çº¢ */
            --c-primary-dark: #922b21;
            --c-gold: #f1c40f;          /* ä½›å…‰é‡‘ */
            --c-gold-shine: #f9e79f;
            --c-bg-dark: #1a0f0f;       /* ç„é“é»‘ */
            --c-paper: #f4ecda;         /* å®£çº¸ç™½ */
            --c-text-ink: #2c3e50;      /* å¾½å¢¨ */
            --c-success: #27ae60;
            --c-error: #c0392b;
            
            --shadow-card: 0 15px 35px rgba(0,0,0,0.6), 0 5px 15px rgba(0,0,0,0.4);
            /* å­—ä½“æ ˆä¼˜åŒ–ï¼šä¼˜å…ˆ Macåæ–‡æ¥·ä½“/Windowsæ¥·ä½“/ä»¿å®‹ï¼Œæœ€åå›é€€åˆ°è¡¬çº¿ä½“ */
            --font-main: "STKaiti", "KaiTi", "SimKai", "BiauKai", "FangSong", "Lisu", "Microsoft YaHei", serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0;
            padding: 0;
            font-family: var(--font-main);
            background-color: var(--c-bg-dark);
            color: var(--c-text-ink);
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            /* å…¨å±€å¢åŠ å¾®å°çš„å­—é—´è·ï¼Œæå‡å¤é£è´¨æ„Ÿ */
            letter-spacing: 0.05em;
        }

        /* =========================================
           2. åŠ¨æ€èƒŒæ™¯ (Dynamic Background)
           ========================================= */
        .bg-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0;
        }

        /* é™æ€åº•å›¾ */
        .bg-static {
            background: radial-gradient(circle at center bottom, #4a2c2c 0%, #1a0f0f 80%);
            background-image: url("assets/bg-1.png");
        }

        /* åŠ¨æ€äº‘å±‚ */
        .clouds {
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200' viewBox='0 0 400 200'%3E%3Cpath fill='%23ffffff' fill-opacity='0.05' d='M50 100 C70 80 130 80 150 100 S230 120 250 100 S330 80 350 100 S430 120 450 100 V200 H50 Z'/%3E%3C/svg%3E");
            background-size: 800px 400px;
            position: absolute;
            width: 200%;
            height: 100%;
            bottom: 0;
            animation: drift 60s linear infinite;
        }
        .clouds.c2 {
            bottom: -50px;
            opacity: 0.5;
            animation-duration: 40s;
            background-size: 600px 300px;
        }

        @keyframes drift { from { transform: translateX(0); } to { transform: translateX(-50%); } }

        /* =========================================
           3. ä¸»å®¹å™¨ (App Container - æ¨ªç‰ˆä¼˜åŒ–)
           ========================================= */
        #app {
            position: relative;
            z-index: 10;
            width: 100%;
            /* PCç«¯/æ¨ªå±æœ€å¤§å®½åº¦è®¾ä¸º 1000pxï¼Œé«˜åº¦é€‚é… */
            max-width: 1000px; 
            height: 100vh;
            height: 100dvh; 
            /* PCç«¯é™åˆ¶é«˜åº¦ï¼Œé¿å…è¿‡äºç»†é•¿ */
            max-height: 750px; 
            display: flex;
            flex-direction: column;
        }

        @media (min-width: 768px) {
            #app {
                height: 90vh; /* ç•™å‡ºè¾¹è· */
                border-radius: 24px;
                border: 2px solid rgba(241, 196, 15, 0.3);
                background: rgba(20, 10, 10, 0.6);
                backdrop-filter: blur(10px);
                box-shadow: 0 0 80px rgba(0,0,0,0.8);
            }
        }

        /* é€šç”¨éšè—ç±» */
        .hidden { display: none !important; }
        .fade-enter { animation: fadeIn 0.8s ease forwards; }

        /* =========================================
           4. é¦–é¡µ (Home Screen)
           ========================================= */
        .screen-home {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 30px;
        }

        .avatar-ring {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            border: 4px solid var(--c-gold);
            padding: 6px;
            background: linear-gradient(135deg, #4a0000, #000);
            box-shadow: 0 0 40px var(--c-primary);
            position: relative;
            margin-bottom: 20px;
            animation: pulseGlow 3s infinite;
            flex-shrink: 0;
        }
        
        .avatar-img {
            width: 100%; height: 100%; border-radius: 50%;
            object-fit: cover; background: #333;
            /* å­™æ‚Ÿç©ºå¤´åƒï¼šè¯·ç¡®ä¿ assets/hero-wukong-768x768.png å­˜åœ¨ï¼Œå¦åˆ™æ˜¾ç¤ºç°è‰²èƒŒæ™¯ */
            background-image: url('assets/hero-wukong-768x768.png');
            background-size: cover;
            background-position: center;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .main-title {
            font-size: 4rem;
            margin: 0 0 40px 0;
            font-weight: 900;
            letter-spacing: 0.25em;
            margin-left: 0.25em;
            position: relative;
            
            /* æ›´åŠ æ˜äº®é²œå¿«çš„é‡‘è‰²æ¸å˜ */
            background: linear-gradient(
                to bottom,
                #fff 0%,
                #fffde7 15%, /* å¢åŠ äº®ç™½æ¯”ä¾‹ */
                #ffeb3b 40%, /* äº®é»„è‰² */
                #fdd835 60%, /* æ˜é‡‘ */
                #fbc02d 85%,
                #f9a825 100%
            );
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            
            /* 3D ç«‹ä½“é˜´å½±ï¼šé¢œè‰²ä»æ·±è¤æ”¹ä¸ºæ˜äº®çš„çº¢æ©™è‰²ï¼Œå¢åŠ é²œå¿«æ„Ÿ */
            filter: drop-shadow(0 0 20px rgba(255, 235, 59, 0.5));
            text-shadow: 
                0 1px 0 #d84315,
                0 2px 0 #bf360c,
                0 3px 0 #a23000,
                0 4px 0 #8e2a00,
                0 5px 0 #7a2400,
                0 6px 1px rgba(0,0,0,.1),
                0 0 5px rgba(0,0,0,.1),
                0 1px 3px rgba(0,0,0,.3),
                0 3px 5px rgba(0,0,0,.2),
                0 5px 10px rgba(0,0,0,.25),
                0 10px 10px rgba(0,0,0,.2),
                0 20px 20px rgba(0,0,0,.15);
            
            /* èµ‹äºˆæ ‡é¢˜å¾®å¾®çš„å‘¼å¸æ„Ÿå’Œæµ®åŠ¨æ„Ÿ */
            animation: titleEpic 4s ease-in-out infinite;
        }

        @keyframes titleEpic {
            0%, 100% { 
                transform: translateY(0) scale(1); 
                filter: drop-shadow(0 0 15px rgba(241, 196, 15, 0.4));
            }
            50% { 
                transform: translateY(-5px) scale(1.02); 
                filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.7));
            }
        }

        .btn-epic {
            position: relative;
            background: linear-gradient(to bottom, #d35400, #a04000);
            border: none;
            padding: 16px 45px;
            font-size: 1.3rem;
            color: #fff;
            font-family: var(--font-main);
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 0 #6e2c00, 0 15px 20px rgba(0,0,0,0.4);
            transition: all 0.1s;
            min-width: 200px;
            margin: 10px 0;
            overflow: hidden;
            /* æŒ‰é’®æ–‡å­—é—´è· */
            letter-spacing: 0.1em;
            text-indent: 0.1em;
        }
        .btn-epic:active { transform: translateY(4px); box-shadow: 0 4px 0 #6e2c00; }
        .btn-epic::after {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: rotate(45deg); animation: shine 3s infinite;
        }

        .btn-ghost {
            background: transparent; border: 2px solid rgba(241, 196, 15, 0.5); color: var(--c-gold);
            padding: 10px 30px; border-radius: 30px; font-size: 1rem; margin-top: 10px; cursor: pointer; transition: all 0.3s;
        }
        .btn-ghost:hover { background: rgba(241, 196, 15, 0.1); border-color: var(--c-gold); }

        /* =========================================
           5. æ¸¸æˆç•Œé¢ (Game Screen - å¸ƒå±€æ ¸å¿ƒ)
           ========================================= */
        .screen-game {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 15px;
            overflow: hidden;
        }

        .hud-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.5);
            border: 1px solid rgba(241, 196, 15, 0.3);
            backdrop-filter: blur(5px);
            padding: 8px 20px;
            border-radius: 16px;
            margin-bottom: 15px;
            color: var(--c-gold);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            flex-shrink: 0;
        }
        .hud-group { display: flex; align-items: center; gap: 8px; font-weight: bold; }
        .hud-icon { width: 24px; height: 24px; fill: var(--c-gold); filter: drop-shadow(0 0 5px orange); }

        /* å¿ƒå½¢ */
        .hearts-wrapper { display: flex; gap: 4px; }
        .heart-svg { width: 24px; height: 24px; fill: #e74c3c; transition: all 0.3s; filter: drop-shadow(0 0 2px #c0392b); }
        .heart-svg.lost { fill: #555; transform: scale(0.8); filter: none; }

        /* --- æ»šåŠ¨èˆå° --- */
        .card-stage {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            /* éšè—æ»šåŠ¨æ¡ä½†ä¿ç•™æ»šåŠ¨åŠŸèƒ½ */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE/Edge */
            /* é¡¶éƒ¨æ”¹ä¸º 60pxï¼Œç»™ absoluteå®šä½çš„å¾½ç« ç•™å‡ºç©ºé—´ */
            padding: 60px 15px 100px 15px; 
        }

        .card-stage::-webkit-scrollbar {
            display: none; /* Chrome/Safari */
        }

        /* --- æ ¸å¿ƒå¡ç‰‡ (æ¨ªç‰ˆ/ç«–ç‰ˆ è‡ªé€‚åº”) --- */
        .scroll-card {
            width: 100%;
            background: var(--c-paper);
            border-radius: 8px; 
            position: relative;
            padding: 20px;
            box-shadow: var(--shadow-card);
            border-top: 12px solid #5d4037;
            border-bottom: 12px solid #5d4037;
            margin: 0 auto; /* æ”¹ä¸ºé¡¶éƒ¨å¯¹é½ï¼Œé˜²æ­¢é«˜åº¦å˜åŒ–æ—¶ä¸Šä¸‹è·³åŠ¨ */
            flex-shrink: 0;
            
            /* é»˜è®¤ç«–ç‰ˆå¸ƒå±€ */
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* å·è½´çº¹ç†èƒŒæ™¯ */
        .scroll-card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23d7ccc8' fill-opacity='0.2'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7z'/%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.5; pointer-events: none; z-index: 0;
        }

        .question-badge {
            position: absolute; top: -50px; left: 50%; transform: translateX(-50%);
            background: var(--c-primary); color: #fff; padding: 5px 20px;
            border: 2px solid var(--c-gold); border-radius: 8px; font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 5px; white-space: nowrap;
            z-index: 2;
            /* å¾½ç« å­—ä½“ä¼˜åŒ– */
            letter-spacing: 0.1em;
            font-family: var(--font-main);
        }

        /* --- å›¾ç‰‡åŒºåŸŸ --- */
        .q-image-frame {
            position: relative; z-index: 1;
            width: 100%;
            height: 180px; 
            background: #3e2723;
            border: 4px solid #8d6e63; /* åŠ ç²—è¾¹æ¡† */
            border-radius: 6px;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
            flex-shrink: 0;
        }
        .q-image { width: 100%; height: 100%; object-fit: cover; transition: transform 3s ease; display: block; }
        .scroll-card:hover .q-image { transform: scale(1.1); }

        /* --- å†…å®¹åŒºåŸŸ --- */
        .card-content {
            position: relative; z-index: 1;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .q-text {
            /* å¢åŠ è¡Œé«˜å’Œå­—é‡ï¼Œæå‡æ¥·ä½“æ˜“è¯»æ€§ */
            font-size: 1.3rem; 
            line-height: 1.6; 
            color: #3e2723; 
            font-weight: 600; /* ç¨å¾®åŠ ç²— */
            margin-bottom: 20px; 
            min-height: 40px; 
            display: flex; 
            align-items: center;
            letter-spacing: 0.05em;
        }

        /* é€‰é¡¹å®¹å™¨ */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr; /* é»˜è®¤å•åˆ— */
            gap: 10px;
        }

        .opt-btn {
            width: 100%; padding: 14px; background: #fff;
            border: 1px solid #d7ccc8; border-left: 5px solid #8d6e63;
            border-radius: 6px; color: #5d4037; font-size: 1rem;
            text-align: left; cursor: pointer; transition: all 0.2s; position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            /* é€‰é¡¹æ–‡å­—ä¼˜åŒ– */
            font-weight: 600;
            letter-spacing: 0.02em;
        }
        .opt-btn:hover { transform: translateX(3px); background: #fafafa; border-left-color: var(--c-primary); }
        .opt-btn.correct { background: #d4edda; border-color: #28a745; border-left-color: #28a745; color: #155724; animation: pulseGreen 0.5s; }
        .opt-btn.wrong { background: #f8d7da; border-color: #dc3545; border-left-color: #dc3545; color: #721c24; animation: shake 0.4s; }

        .feedback-box {
            margin-top: 0; 
            padding: 0 12px; 
            background: rgba(139, 69, 19, 0.08);
            border-radius: 8px; 
            text-align: center; 
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transform: translateY(10px); 
            transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1), 
                        opacity 0.4s ease, 
                        transform 0.4s ease,
                        margin-top 0.4s ease,
                        padding 0.4s ease;
        }
        .feedback-box.show { 
            opacity: 1; 
            max-height: 400px; /* è¶³å¤Ÿå®¹çº³è§£é‡Šæ–‡å­—çš„é«˜åº¦ */
            transform: translateY(0); 
            margin-top: 15px;
            padding: 12px;
        }

        .btn-next {
            background: var(--c-primary); color: #fff; border: none; padding: 8px 30px;
            border-radius: 25px; font-size: 1rem; cursor: pointer; margin-top: 8px;
            box-shadow: 0 4px 10px rgba(192, 57, 43, 0.4); display: none;
        }

        /* =========================================
           7. å“åº”å¼å¸ƒå±€ä¼˜åŒ– (Responsive Layout)
           ========================================= */
        
        /* å¹³æ¿/æ¡Œé¢ç«¯ (æ¨ªç‰ˆä¼˜åŒ–) */
        @media (min-width: 768px) {
            .scroll-card {
                /* æ”¹ä¸ºæ¨ªå‘ Flex å¸ƒå±€ */
                flex-direction: row; 
                align-items: stretch;
                padding: 40px; /* å†…è¾¹è·åŠ å¤§ */
            }

            .q-image-frame {
                width: 40%; /* å›¾ç‰‡å å·¦ä¾§ 40% */
                height: auto; /* é«˜åº¦è‡ªåŠ¨è·Ÿéš */
                min-height: 250px;
                border-right: none;
                margin-bottom: 0;
                margin-right: 25px;
            }

            .card-content {
                width: 60%; /* å†…å®¹å å³ä¾§ */
                justify-content: center;
            }

            .q-text {
                /* PCç«¯å­—ä½“ç¨å¤§ */
                font-size: 1.5rem;
                margin-bottom: 25px;
                justify-content: flex-start; /* å·¦å¯¹é½ */
                line-height: 1.8;
            }

            /* åŒåˆ—é€‰é¡¹ */
            .options-grid {
                grid-template-columns: 1fr 1fr; 
                gap: 15px;
            }

            .opt-btn {
                padding: 16px;
                font-size: 1.1rem;
                text-align: center; /* æ¨ªç‰ˆæ—¶å±…ä¸­å¯¹é½æ–‡å­— */
                border-left-width: 1px; /* å¼±åŒ–å·¦è¾¹æ¡†ï¼Œæ”¹ä¸ºæ•´ä½“æ„Ÿ */
                border-bottom: 4px solid #d7ccc8; /* å¢åŠ åº•éƒ¨ç«‹ä½“æ„Ÿ */
            }
            .opt-btn:hover {
                transform: translateY(-2px); /* å‘ä¸Šæµ®åŠ¨ */
                border-left-color: #d7ccc8; /* æ¢å¤è¾¹æ¡†è‰² */
                border-bottom-color: var(--c-primary);
            }
            .opt-btn.correct { border-bottom-color: #28a745; border-left-color: #28a745; }
            .opt-btn.wrong { border-bottom-color: #dc3545; border-left-color: #dc3545; }
        }

        /* åŠ¨ç”»å…³é”®å¸§ */
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes pulseGlow { 0% { box-shadow: 0 0 20px var(--c-primary); } 50% { box-shadow: 0 0 40px var(--c-gold); } 100% { box-shadow: 0 0 20px var(--c-primary); } }
        @keyframes shine { 0% { left: -100%; } 20% { left: 100%; } 100% { left: 100%; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 20% { transform: translateX(-8px); } 40% { transform: translateX(8px); } 60% { transform: translateX(-4px); } 80% { transform: translateX(4px); } }
        @keyframes pulseGreen { 0% { transform: scale(1); } 50% { transform: scale(1.05); background: #c3e6cb; } 100% { transform: scale(1); } }
        
        .slide-in { animation: slideInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(60px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

    <div class="bg-layer bg-static"></div>
    <div class="bg-layer clouds"></div>
    <div class="bg-layer clouds c2"></div>

    <div id="app">
        <!-- HOME SCREEN -->
        <div id="screen-home" class="screen-home fade-enter">
            <div class="avatar-ring">
                <div class="avatar-img"></div>
            </div>
            <h1 class="main-title">è¥¿æ¸¸é—¯å…³</h1>
            <button class="btn-epic" onclick="startGame(true)">è¸ä¸Šå¾é€”</button>
            <button class="btn-ghost" id="btn-continue" onclick="startGame(false)" style="display:none">ç»§ç»­ä¿®è¡Œ</button>
            <button class="btn-ghost" onclick="resetData()">é‡ç½®è½®å›</button>
            <div style="margin-top: 30px; color: #aaa; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 2px;">Journey to the West</div>
        </div>

        <!-- GAME SCREEN -->
        <div id="screen-game" class="screen-game hidden">
            <!-- HUD -->
            <div class="hud-bar">
                <div class="hud-group">
                    <svg class="hud-icon" viewBox="0 0 24 24"><path d="M20.5 3l-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5zM15 19l-6-2.11V5l6 2.11V19z"/></svg>
                    <span>ç¬¬ <span id="level-display" class="hud-val">1</span> éš¾</span>
                    <span style="font-size:0.8em; opacity:0.7; margin-left:5px">/ 10</span>
                </div>
                <div class="hud-group">
                    <span style="font-size: 0.8em; color: #e67e22;" id="streak-display"></span>
                    <svg class="hud-icon" style="fill:#f1c40f;" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                    <span id="score-display" class="hud-val">0</span>
                </div>
                <div class="hearts-wrapper" id="hearts-container"></div>
            </div>

            <!-- CARD STAGE -->
            <div class="card-stage">
                <div class="scroll-card slide-in">
                    <div class="question-badge">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                        <span>å¤©åº­è€ƒé¢˜</span>
                    </div>
                    
                    <!-- å·¦ä¾§ï¼šå›¾ç‰‡ (PCç«¯) / é¡¶éƒ¨ï¼šå›¾ç‰‡ (ç§»åŠ¨ç«¯) -->
                    <div class="q-image-frame">
                        <img id="q-image" class="q-image" src="" alt="é¢˜ç›®æ’å›¾" onerror="this.src='https://placehold.co/600x400/5d4037/f4ecda?text=è¥¿æ¸¸ä¸–ç•Œ'">
                    </div>

                    <!-- å³ä¾§ï¼šå†…å®¹ (PCç«¯) / åº•éƒ¨ï¼šå†…å®¹ (ç§»åŠ¨ç«¯) -->
                    <div class="card-content">
                        <div class="q-text" id="question-text">åŠ è½½ä¸­...</div>
                        
                        <!-- é€‰é¡¹ä½¿ç”¨ Grid å¸ƒå±€ -->
                        <div id="options-container" class="options-grid"></div>

                        <div class="feedback-box" id="feedback-area">
                            <p id="explanation-text" style="color:#5d4037; margin-bottom:10px; font-size: 0.95rem;"></p>
                            <button class="btn-next" id="next-btn" onclick="nextLevel()">ä¸‹ä¸€éš¾</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RESULT SCREEN -->
        <div id="screen-result" class="screen-home hidden fade-enter">
            <h2 class="main-title" id="result-title">ä¿®æˆæ­£æœ</h2>
            <div style="font-size: 5rem; color: var(--c-gold); font-weight: bold; margin-bottom: 20px; text-shadow: 0 0 30px var(--c-primary);" id="final-score">0</div>
            <p style="color: #ccc; margin-bottom: 30px;">æœ€ç»ˆåŠŸå¾·</p>
            <button class="btn-epic" onclick="showHome()">é‡è¿”å¤©åº­</button>
        </div>
    </div>

<script>
    /* =========================================
       GAME LOGIC
       ========================================= */
    const SVG_HEART = `<svg class="heart-svg" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`;
    const SVG_HEART_BROKEN = `<svg class="heart-svg lost" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`;

    const QUESTIONS_DB = [
        { id: 1, imgKeyword: "é‡‘ç®æ£’", question: "å­™æ‚Ÿç©ºçš„é‡‘ç®æ£’é‡è¾¾å¤šå°‘æ–¤ï¼Ÿ", options: ["ä¸€ä¸‡ä¸‰åƒäº”ç™¾æ–¤", "ä¸‰åƒå…­ç™¾æ–¤", "ä¹åƒæ–¤", "åä¸‡å…«åƒæ–¤"], answerIndex: 0, explanation: "é‡‘ç®æ£’å…¨å'å¦‚æ„é‡‘ç®æ£’'ï¼Œé‡ä¸€ä¸‡ä¸‰åƒäº”ç™¾æ–¤ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 2, imgKeyword: "çŒªå…«æˆ’", question: "å”åƒ§çš„äºŒå¾’å¼Ÿæ˜¯è°ï¼Ÿ", options: ["æ²™åƒ§", "çŒªå…«æˆ’", "å°ç™½é¾™", "å­™æ‚Ÿç©º"], answerIndex: 1, explanation: "å¤§å¾’å¼Ÿå­™æ‚Ÿç©ºï¼ŒäºŒå¾’å¼ŸçŒªå…«æˆ’ï¼ˆæ‚Ÿèƒ½ï¼‰ï¼Œä¸‰å¾’å¼Ÿæ²™æ‚Ÿå‡€ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 3, imgKeyword: "äº”è¡Œå±±", question: "å­™æ‚Ÿç©ºè¢«å‹åœ¨ä»€ä¹ˆå±±ä¸‹ï¼Ÿ", options: ["ç«ç„°å±±", "èŠ±æœå±±", "äº”è¡Œå±±", "çµå±±"], answerIndex: 2, explanation: "å¦‚æ¥ä½›ç¥–å°†å­™æ‚Ÿç©ºå‹åœ¨äº”è¡Œå±±ï¼ˆååä¸¤ç•Œå±±ï¼‰ä¸‹äº”ç™¾å¹´ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 4, imgKeyword: "å¤§é—¹å¤©å®«", question: "è°å¤§é—¹äº†å¤©å®«ï¼Ÿ", options: ["å“ªå’", "äºŒéƒç¥", "å­™æ‚Ÿç©º", "ç‰›é­”ç‹"], answerIndex: 2, explanation: "å­™æ‚Ÿç©ºå› ä¸æ»¡å¼¼é©¬æ¸©å®˜èŒå’Œæœªè¢«é‚€è¯·èŸ æ¡ƒä¼šï¼Œå¤§é—¹å¤©å®«ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 5, imgKeyword: "é›·éŸ³å¯º", question: "å”åƒ§å–ç»çš„ç›®çš„åœ°æ˜¯å“ªé‡Œï¼Ÿ", options: ["å¤©åº­", "è¥¿å¤©é›·éŸ³å¯º", "å—æµ·æ™®é™€å±±", "ä¸œæµ·é¾™å®«"], answerIndex: 1, explanation: "å¸ˆå¾’å››äººå‰å¾€è¥¿å¤©å¤§é›·éŸ³å¯ºæ‹œä½›æ±‚ç»ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 6, imgKeyword: "ç™½éª¨ç²¾", question: "ç™½éª¨ç²¾å˜åŒ–äº†å‡ æ¬¡æ¥æ¬ºéª—å”åƒ§ï¼Ÿ", options: ["ä¸€æ¬¡", "ä¸¤æ¬¡", "ä¸‰æ¬¡", "å››æ¬¡"], answerIndex: 2, explanation: "ä¸‰æ‰“ç™½éª¨ç²¾ï¼šå…ˆå˜æ‘å§‘ï¼Œå†å˜è€å¦‡ï¼Œæœ€åå˜è€ç¿ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 7, imgKeyword: "é«˜è€åº„", question: "çŒªå…«æˆ’åœ¨é«˜è€åº„åŸæœ¬æƒ³å¨¶è°ï¼Ÿ", options: ["é«˜ç¿ å…°", "å«¦å¨¥", "å¥³å„¿å›½å›½ç‹", "é“æ‰‡å…¬ä¸»"], answerIndex: 0, explanation: "çŒªå…«æˆ’å…¥èµ˜é«˜è€åº„ï¼Œæƒ³å¨¶é«˜å¤ªå…¬ä¹‹å¥³é«˜ç¿ å…°ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 8, imgKeyword: "å·å¸˜å¤§å°†", question: "æ²™åƒ§åœ¨è¢«è´¬æµæ²™æ²³ä¹‹å‰æ˜¯ä»€ä¹ˆå®˜èŒï¼Ÿ", options: ["å¤©è“¬å…ƒå¸…", "å·å¸˜å¤§å°†", "å¼¼é©¬æ¸©", "é½å¤©å¤§åœ£"], answerIndex: 1, explanation: "æ²™åƒ§åŸæ˜¯å¤©åº­çš„å·å¸˜å¤§å°†ï¼Œå› æ‰“ç ´ç‰ç’ƒç›è¢«è´¬ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 9, imgKeyword: "çº¢å­©å„¿", question: "çº¢å­©å„¿çš„ç»æ‹›æ˜¯ä»€ä¹ˆï¼Ÿ", options: ["ä¸‰æ˜§çœŸç«", "ä¸ƒåäºŒå˜", "ç´§ç®å’’", "è¢–é‡Œä¹¾å¤"], answerIndex: 0, explanation: "çº¢å­©å„¿èƒ½åœ¨é¼»ä¸­å–·å‡ºä¸‰æ˜§çœŸç«ï¼Œè¿å­™æ‚Ÿç©ºéƒ½éš¾ä»¥æŠµæŒ¡ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 10, imgKeyword: "èŠ­è•‰æ‰‡", question: "è¿‡ç«ç„°å±±éœ€è¦å€Ÿä»€ä¹ˆå®ç‰©ï¼Ÿ", options: ["ç´«é‡‘è‘«èŠ¦", "èŠ­è•‰æ‰‡", "å®šé£ç ", "ç¾Šè„‚ç‰å‡€ç“¶"], answerIndex: 1, explanation: "åªæœ‰é“æ‰‡å…¬ä¸»çš„èŠ­è•‰æ‰‡èƒ½æ‰‡ç­ç«ç„°å±±çš„ç«ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 11, imgKeyword: "å¥³å„¿å›½", question: "å¥³å„¿å›½å›½ç‹æƒ³è®©è°ç•™ä¸‹æˆäº²ï¼Ÿ", options: ["å­™æ‚Ÿç©º", "çŒªå…«æˆ’", "å”åƒ§", "æ²™åƒ§"], answerIndex: 2, explanation: "å¥³å„¿å›½å›½ç‹å¯¹å”åƒ§æƒ…æœ‰ç‹¬é’Ÿï¼Œæ„¿ä»¥å›½ç›¸æ‰˜ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 12, imgKeyword: "å…­è€³çŒ•çŒ´", question: "çœŸå‡ç¾çŒ´ç‹ä¸­ï¼Œå‡æ‚Ÿç©ºæ˜¯è°å˜çš„ï¼Ÿ", options: ["é€šè‡‚çŒ¿çŒ´", "å…­è€³çŒ•çŒ´", "èµ¤å°»é©¬çŒ´", "çµæ˜çŸ³çŒ´"], answerIndex: 1, explanation: "å…­è€³çŒ•çŒ´å–„è†éŸ³ï¼Œèƒ½å¯Ÿç†ï¼ŒçŸ¥å‰åï¼Œä¸‡ç‰©çš†æ˜ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 13, imgKeyword: "è©æç¥–å¸ˆ", question: "å­™æ‚Ÿç©ºçš„æˆä¸šæ©å¸ˆæ˜¯è°ï¼Ÿ", options: ["å¤ªä¸Šè€å›", "è§‚éŸ³è©è¨", "è©æç¥–å¸ˆ", "å”åƒ§"], answerIndex: 2, explanation: "å­™æ‚Ÿç©ºåœ¨çµå°æ–¹å¯¸å±±æ–œæœˆä¸‰æ˜Ÿæ´æ‹œè©æç¥–å¸ˆä¸ºå¸ˆã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 14, imgKeyword: "ä¹é½¿é’‰è€™", question: "çŒªå…«æˆ’ä½¿ç”¨çš„æ­¦å™¨æ˜¯ä»€ä¹ˆï¼Ÿ", options: ["ä¹é½¿é’‰è€™", "é™å¦–å®æ–", "æ–¹å¤©ç”»æˆŸ", "å®£èŠ±æ¿æ–§"], answerIndex: 0, explanation: "çŒªå…«æˆ’æ‰‹æŒä¹é½¿é’‰è€™ï¼Œå…¨åä¸Šå®æ²é‡‘é’¯ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 15, imgKeyword: "è§‚éŸ³è©è¨", question: "å“ªä½ç¥ä»™å¸®åŠ©æ”¶æœäº†çº¢å­©å„¿ï¼Ÿ", options: ["å¦‚æ¥ä½›ç¥–", "å¤ªä¸Šè€å›", "è§‚éŸ³è©è¨", "æ‰˜å¡”å¤©ç‹"], answerIndex: 2, explanation: "è§‚éŸ³è©è¨ç”¨é‡‘ç®æ”¶æœçº¢å­©å„¿ï¼Œè®©ä»–åšäº†å–„è´¢ç«¥å­ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 16, imgKeyword: "ä¸ƒåäºŒå˜", question: "å­™æ‚Ÿç©ºæœ‰å¤šå°‘ç§å˜åŒ–ï¼Ÿ", options: ["ä¸‰åå…­å˜", "ä¸ƒåäºŒå˜", "ä¸€ç™¾é›¶å…«å˜", "æ— æ•°å˜"], answerIndex: 1, explanation: "å­™æ‚Ÿç©ºå­¦ä¼šäº†åœ°ç…ä¸ƒåäºŒå˜ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 17, imgKeyword: "å”åƒ§è‚‰", question: "åƒå”åƒ§è‚‰å¯ä»¥é•¿ç”Ÿä¸è€çš„è°£è¨€æ˜¯è°å…ˆä¼ çš„ï¼Ÿ", options: ["ç™½éª¨ç²¾", "é‡‘è§’å¤§ç‹", "å¹¶æ²¡æœ‰æ˜ç¡®è¯´æ˜", "å¦‚æ¥ä½›ç¥–"], answerIndex: 2, explanation: "ä¹¦ä¸­å¤šå¤„å¦–æ€ªæåˆ°ï¼Œä½†æºå¤´å¹¶æœªæ˜ç¡®æŒ‡å‘å•ä¸€å¦–æ€ªï¼Œé€šå¸¸è®¤ä¸ºæ˜¯å¦–ç•Œçš„ä¼ è¨€ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 18, imgKeyword: "äººå‚æœ", question: "äººå‚æœæ ‘å¤šå°‘å¹´ç»“ä¸€æ¬¡æœï¼Ÿ", options: ["ä¸‰åƒå¹´", "å…­åƒå¹´", "ä¹åƒå¹´", "ä¸€ä¸‡å¹´"], answerIndex: 2, explanation: "ä¸‰åƒå¹´ä¸€å¼€èŠ±ï¼Œä¸‰åƒå¹´ä¸€ç»“æœï¼Œä¸‰åƒå¹´æ‰æˆç†Ÿï¼Œå…±ä¹åƒå¹´ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 19, imgKeyword: "å°ç™½é¾™", question: "å°ç™½é¾™åŸæœ¬æ˜¯å“ªé‡Œçš„å¤ªå­ï¼Ÿ", options: ["ä¸œæµ·", "å—æµ·", "è¥¿æµ·", "åŒ—æµ·"], answerIndex: 2, explanation: "å°ç™½é¾™æ˜¯è¥¿æµ·é¾™ç‹ä¸‰å¤ªå­æ•–çƒˆã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 20, imgKeyword: "ç«ç„°å±±", question: "å¤ªä¸Šè€å›çš„ç‚¼ä¸¹ç‚‰è¢«å­™æ‚Ÿç©ºè¸¢ç¿»åå˜æˆäº†ä»€ä¹ˆï¼Ÿ", options: ["æµæ²™æ²³", "é€šå¤©æ²³", "ç«ç„°å±±", "äº”è¡Œå±±"], answerIndex: 2, explanation: "ç‚‰ç –è·Œè½å‡¡é—´ï¼ŒåŒ–ä½œäº†ç«ç„°å±±ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 21, imgKeyword: "é‡‘è§’é“¶è§’", question: "é‡‘è§’å¤§ç‹å’Œé“¶è§’å¤§ç‹åŸæœ¬æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ", options: ["çƒ§ç«ç«¥å­", "å¤©åº­å®ˆå«", "é¾™å®«è™¾å…µ", "åœ°åºœé¬¼å·®"], answerIndex: 0, explanation: "ä»–ä»¬æ˜¯å¤ªä¸Šè€å›çœ‹å®ˆé‡‘ç‚‰å’Œé“¶ç‚‰çš„ç«¥å­ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 22, imgKeyword: "é½å¤©å¤§åœ£", question: "å­™æ‚Ÿç©ºåœ¨èŠ±æœå±±ç§°è‡ªå·±ä¸ºä»€ä¹ˆï¼Ÿ", options: ["ç¾çŒ´ç‹", "é½å¤©å¤§åœ£", "å­™è¡Œè€…", "æ–—æˆ˜èƒœä½›"], answerIndex: 1, explanation: "å­™æ‚Ÿç©ºç«–èµ·å¤§æ——ï¼Œè‡ªç§°â€œé½å¤©å¤§åœ£â€ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 23, imgKeyword: "ç´§ç®å’’", question: "ç´§ç®å’’æ˜¯è°ä¼ ç»™å”åƒ§çš„ï¼Ÿ", options: ["å¦‚æ¥ä½›ç¥–", "è§‚éŸ³è©è¨", "ç‰çš‡å¤§å¸", "å¤ªä¸Šè€å›"], answerIndex: 1, explanation: "è§‚éŸ³è©è¨ä¼ æˆå”åƒ§ç´§ç®å’’ï¼Œä»¥æ­¤çº¦æŸæ‚Ÿç©ºã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 24, imgKeyword: "è½¦è¿Ÿå›½", question: "è½¦è¿Ÿå›½ä¸‰å›½å¸ˆå’Œå­™æ‚Ÿç©ºæ¯”è¯•ä»€ä¹ˆï¼Ÿ", options: ["æ­¦è‰º", "æ±‚é›¨", "å¿µç»", "ç‚¼ä¸¹"], answerIndex: 1, explanation: "å…¶ä¸­ä¸€åœºç»å…¸æ¯”è¯•æ˜¯ç¥ˆé›¨ï¼Œä»¥åŠåç»­çš„ç å¤´ã€å‰–å¿ƒã€ä¸‹æ²¹é”…ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 25, imgKeyword: "çµæ„Ÿå¤§ç‹", question: "é€šå¤©æ²³é‡Œçš„å¦–æ€ªæ˜¯ä»€ä¹ˆæˆç²¾ï¼Ÿ", options: ["é²¤é±¼", "ä¹Œé¾Ÿ", "æ²³é©¬", "é³„é±¼"], answerIndex: 0, explanation: "çµæ„Ÿå¤§ç‹æ˜¯è§‚éŸ³è©è¨è²èŠ±æ± é‡Œå…»å¤§çš„é‡‘é±¼ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 26, imgKeyword: "é‡‘é“™", question: "é»„çœ‰å¤§ç‹ç”¨ä»€ä¹ˆæ³•å®å›°ä½äº†å­™æ‚Ÿç©ºï¼Ÿ", options: ["é‡‘é“™", "äººç§è¢‹", "æ†ä»™ç»³", "ç´«é‡‘é“ƒ"], answerIndex: 0, explanation: "é»„çœ‰æ€ªå…ˆç”¨é‡‘é“™æŠŠæ‚Ÿç©ºæ‰£åœ¨é‡Œé¢ï¼Œåç”¨åå¤©äººç§è¢‹æ”¶äººã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 27, imgKeyword: "å…«åä¸€éš¾", question: "è¥¿å¤©å–ç»ä¸€å…±ç»å†äº†å¤šå°‘éš¾ï¼Ÿ", options: ["ä¸ƒåäºŒéš¾", "å…«åéš¾", "å…«åä¸€éš¾", "ä¹åä¹éš¾"], answerIndex: 2, explanation: "ä¹ä¹å…«åä¸€éš¾ï¼Œå°‘ä¸€éš¾éƒ½ä¸è¡Œï¼ˆæœ€åè¡¥äº†é€šå¤©æ²³è€é¼‹ä¸€éš¾ï¼‰ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 28, imgKeyword: "æ–—æˆ˜èƒœä½›", question: "å¦‚æ¥ä½›ç¥–å°å­™æ‚Ÿç©ºä¸ºä»€ä¹ˆä½›ï¼Ÿ", options: ["æ—ƒæª€åŠŸå¾·ä½›", "æ–—æˆ˜èƒœä½›", "å‡€å›ä½¿è€…", "é‡‘èº«ç½—æ±‰"], answerIndex: 1, explanation: "å­™æ‚Ÿç©ºè¢«å°ä¸ºæ–—æˆ˜èƒœä½›ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 29, imgKeyword: "å‡€å›ä½¿è€…", question: "çŒªå…«æˆ’æœ€åè¢«å°ä¸ºä»€ä¹ˆï¼Ÿ", options: ["å‡€å›ä½¿è€…", "é‡‘èº«ç½—æ±‰", "å¤©è“¬å…ƒå¸…", "ç¦æ˜Ÿ"], answerIndex: 0, explanation: "å› å…¶é£Ÿè‚ å®½å¤§ï¼Œè¢«å°ä¸ºå‡€å›ä½¿è€…ï¼Œäº«å—å…«æ–¹é¦™ç«ã€‚", reward: {score:10}, penalty:{hp:1} },
        { id: 30, imgKeyword: "å´æ‰¿æ©", question: "ã€Šè¥¿æ¸¸è®°ã€‹çš„ä½œè€…é€šå¸¸è¢«è®¤ä¸ºæ˜¯è°ï¼Ÿ", options: ["ç½—è´¯ä¸­", "æ–½è€åºµ", "å´æ‰¿æ©", "æ›¹é›ªèŠ¹"], answerIndex: 2, explanation: "æ˜ä»£å°è¯´å®¶å´æ‰¿æ©ã€‚", reward: {score:10}, penalty:{hp:1} }
    ];

    const MAX_HP = 3;
    const TOTAL_ROUNDS = 10; // æ¯å±€éšæœºæŠ½ 10 é“é¢˜
    const STORAGE_KEY = 'xiYouData_v4'; // æ›´æ–° Key ä»¥æ¸…ç†æ—§ç¼“å­˜
    
    let state = { 
        questions: [], // å½“å‰å±€çš„é¢˜ç›®åˆ—è¡¨
        idx: 0, 
        score: 0, 
        streak: 0, 
        hp: MAX_HP, 
        over: false 
    };

    const dom = {
        screens: { home: document.getElementById('screen-home'), game: document.getElementById('screen-game'), result: document.getElementById('screen-result') },
        btnCont: document.getElementById('btn-continue'),
        level: document.getElementById('level-display'), score: document.getElementById('score-display'), streak: document.getElementById('streak-display'), hearts: document.getElementById('hearts-container'),
        qText: document.getElementById('question-text'), qImg: document.getElementById('q-image'), 
        opts: document.getElementById('options-container'), feedback: document.getElementById('feedback-area'), explain: document.getElementById('explanation-text'), nextBtn: document.getElementById('next-btn'),
        card: document.querySelector('.scroll-card'), finalScore: document.getElementById('final-score'), resultTitle: document.getElementById('result-title')
    };

    window.onload = checkSave;

    function checkSave() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
            const d = JSON.parse(saved);
            // æ£€æŸ¥å­˜æ¡£æ˜¯å¦æœ‰æ•ˆä¸”æœªç»“æŸ
            if (!d.over && d.hp > 0 && d.idx < d.questions.length) dom.btnCont.style.display = 'inline-block';
        }
    }

    function startGame(isNew) {
        if (isNew) { 
            // éšæœºæ´—ç‰Œå¹¶æŠ½å– 10 é“é¢˜
            const shuffled = [...QUESTIONS_DB].sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, TOTAL_ROUNDS);
            
            state = { 
                questions: selected,
                idx: 0, 
                score: 0, 
                streak: 0, 
                hp: MAX_HP, 
                over: false 
            }; 
            save(); 
        } else { 
            state = JSON.parse(localStorage.getItem(STORAGE_KEY)); 
        }
        showScreen('game'); renderRound();
    }

    function showScreen(name) {
        Object.values(dom.screens).forEach(el => el.classList.add('hidden'));
        dom.screens[name].classList.remove('hidden');
    }

    function renderRound() {
        // æ£€æŸ¥æ˜¯å¦é€šå…³ (å½“å‰ç´¢å¼• >= é¢˜ç›®æ€»æ•°)
        if (state.idx >= state.questions.length) { endGame(true); return; }
        
        const q = state.questions[state.idx];
        
        dom.level.innerText = state.idx + 1; 
        dom.score.innerText = state.score;
        dom.streak.innerHTML = state.streak > 1 ? `ğŸ”¥ x${state.streak}` : '';
        dom.hearts.innerHTML = '';
        for (let i = 0; i < MAX_HP; i++) dom.hearts.innerHTML += (i < state.hp) ? SVG_HEART : SVG_HEART_BROKEN;

        dom.card.classList.remove('slide-in'); void dom.card.offsetWidth; dom.card.classList.add('slide-in');
        
        // ä¼˜å…ˆåŠ è½½æœ¬åœ°å›¾ç‰‡ï¼Œå¤±è´¥åˆ™å›é€€
        dom.qImg.src = `assets/${q.id}.jpg`;
        dom.qImg.onerror = function() {
            this.src = `https://placehold.co/600x400/5d4037/f4ecda?text=${encodeURIComponent(q.imgKeyword)}`;
            this.onerror = null; 
        };
        
        dom.qText.innerText = q.question;
        
        dom.opts.innerHTML = ''; dom.feedback.classList.remove('show'); dom.nextBtn.style.display = 'none';

        q.options.forEach((txt, i) => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn'; btn.innerText = txt;
            btn.onclick = () => onAnswer(i, btn);
            dom.opts.appendChild(btn);
        });
    }

    let locked = false;
    function onAnswer(choiceIdx, btn) {
        if (locked) return; locked = true;
        
        const q = state.questions[state.idx];
        const isRight = (choiceIdx === q.answerIndex);
        
        Array.from(dom.opts.children).forEach(b => b.disabled = true);

        if (isRight) {
            state.streak++; state.score += q.reward.score + (state.streak > 1 ? 2 : 0);
            btn.classList.add('correct');
        } else {
            state.hp -= q.penalty.hp; state.streak = 0;
            btn.classList.add('wrong');
            dom.opts.children[q.answerIndex].classList.add('correct');
        }
        save();
        
        dom.explain.innerHTML = (isRight ? "<b style='color:#27ae60'>âœ… å›ç­”æ­£ç¡®</b>" : "<b style='color:#c0392b'>âŒ å›ç­”é”™è¯¯</b>") + "<br>" + q.explanation;
        dom.feedback.classList.add('show');

        if (state.hp <= 0) { state.over = true; setTimeout(() => endGame(false), 2000); } 
        else { 
            dom.nextBtn.style.display = 'inline-block';
            if (window.innerWidth < 768) {
                setTimeout(() => dom.card.parentElement.scrollTo({ top: dom.card.parentElement.scrollHeight, behavior: 'smooth' }), 300);
            }
        }
    }

    function nextLevel() {
        state.idx++; locked = false; save(); renderRound();
        dom.card.parentElement.scrollTop = 0;
    }

    function endGame(win) {
        showScreen('result');
        dom.resultTitle.innerText = win ? "ä¿®æˆæ­£æœ" : "é‡æ–°æ¥è¿‡";
        dom.resultTitle.style.color = win ? "#f1c40f" : "#fff";
        dom.finalScore.innerText = state.score;
        localStorage.removeItem(STORAGE_KEY); dom.btnCont.style.display = 'none';
    }

    function showHome() { showScreen('home'); checkSave(); locked = false; }
    function resetData() { localStorage.removeItem(STORAGE_KEY); location.reload(); }
    function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
</script>
</body>
</html>